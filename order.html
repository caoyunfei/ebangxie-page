<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="320" name="MobileOptimized">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta http-equiv="content-type" content="text/html;charset=UTF-8">
<meta name=description content=e帮鞋>
<meta name=keywords content=e帮鞋>
<title>e帮鞋-填写信息</title>
<link rel="shortcut icon" href="images/logo.png"/>
<link rel="stylesheet" type="text/css" href="css/zepto.dialog.css">
<link rel=stylesheet href="css/style.css">
<link rel=stylesheet href="css/order.css">
</head>
<body>
	<div class="wrap">
		<header id="header" class="bg"><div class="city"><a target="_self" href="list.html"><h6>< 返回</h6></a></div>填写订单信息</header>
		<div class="main">
			<form action="#" method="POST" id="forms" autocomplete="off">
				<input type="hidden" name="keyword" id="keyword" value="project_xiu">
				<div class="H-intro">
					<a href="order-detail.html" class="H-cont"></a>
					<span class="H-go"></span>
				</div>
				<div class="H-dlbox">
          <dl class="H-dlList">
              <dt><span class="H-place4"></span></dt>
              <dd><input name="userMobile" value="" placeholder="填写您的手机号" id="number"></dd>
           </dl>
					<dl class="H-dlList">
					   <dt><span class="H-place2"></span></dt>
					   <dd><input name="userAddress" value="" placeholder="填写您的地址" id="place"></dd>
					</dl>
				</div>
				<div class="H-submit">
					<input type="hidden" name="keyword" value="project_xiu">
					<input id="submit" type="button" class="reserBtn bg" value="提交订单">
				</div>
			</form>
		</div>
	</div>
<script src="js/zepto.min.js"></script>
<script src="js/zepto.dialog.js" defer></script>
<script type="text/javascript">
    $(function () {
        var localdata = window.localStorage;
        $('#place').val(localdata.getItem("fdata_place"));
        $('#number').val(localdata.getItem("number"));
      var Hcont = $(".H-cont"),
          data = JSON.parse(localStorage.getItem("data"));
          if(data){
              Hcont.html("共"+data.clickCount+"件，合计"+data.allTotal+"元");
          };
      $('#submit').on('click',function(){
         var    
                place_val = $('#place').val(),
                number = $("#number").val(),
                local = window.location.toString(),
                loll = local.substring(0,local.lastIndexOf("/")+1);
           if(!number){
                $.dialog({
                    content : '请填写您的手机号',       
                    time : 800
                });
                return false;
            }
            if(!/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(number)){
               $.dialog({
                    content : '请填写正确的手机号',        
                    time : 850
                });
               return false;
            }
            if(!place_val){
				        $.dialog({
                    content : '请填写您的地址',				
                    time : 800
                });   
                return false;
            }
            if(place_val.length<3){
				        $.dialog({
                    content : '请填写正确地址',				
                    time : 800
                }); 
                return false;
            }            
            localdata.setItem("fdata_place",place_val);
            localdata.setItem("number",number);
         var data = JSON.parse(localStorage.getItem("data")),
             orderList = data.orderList,
             i = 0,len = orderList.length,
             type = o = null,desc = '';
       function getType(type,subtype){
         type = +type;
         subtype = +subtype;
         if(type === 0){
             if(subtype === 0){
               return "A";
             }else if(subtype === 1){
               return "B";
             }else if(subtype === 2){
               return "C";
             }
         }else if(type === 1){
            if(subtype === 0){
               return "D";
             }else if(subtype === 1){
               return "E";
             }else if(subtype === 2){
               return "F";
             }
         }else if(type === 2){
            if(subtype === 0){
               return "G";
             }else if(subtype === 1){
               return "H";
             }else if(subtype === 2){
               return "I";
             }
         }
       };
        for(;i<len;i++){
          o = orderList[i];
          if(!o.total) continue;
          type = getType(o.type,o.subtype);
          desc += type+"x"+o.curValue+","
        }
       if(desc){
         desc = desc.substring(0,desc.length-1);
       }
       var order = {
                pickupTime:null,
                userAddress:place_val,
                userName:null,
                userMobile:number,
                remark:null,
                productPrice:data.allTotal,
                productNumber:data.clickCount,
                productDesc:desc
       };
        $.ajax({
            type:'post',
            url:'/admin/order/add',
            data:{json:JSON.stringify(order),productNumber:JSON.stringify(order).clickCount},
            dataType:'text',
            success:function(msg){
               var order = JSON.parse(msg);
               if(+order.code === 1000){
                localStorage.setItem("data",'{"allTotal":0,"clickCount":0,"orderList":[{"type":0,"subtype":0,"curValue":0,"count":0,"total":0}]}');
                 localStorage.setItem("id",order.id);
                 window.location = loll+"success.html";
               }else{
                 window.location = loll+"error.html";
               }
            },
            error:function(){
                 window.location = loll+"error.html";
            }
        });
      })
    });</script></body></html>